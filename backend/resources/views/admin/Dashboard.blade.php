@php use Carbon\Carbon; @endphp

@extends('layout')
@section('content')
    <section class="box-border p-0 m-0 bg-gray-200 text-center justify-center items-center h-screen font-poppins">
        <div class="flex gap-[1.5rem] pt-[5rem] pb-[2rem] px-[10rem] bg-gray-200 w-screen">
            <div class="bg-gray-50 w-[14rem] h-[10rem] block justify-center rounded-[5px] box-border border-[0.5px] border-black shadow-lg">
                <div>
                    <h3 class="absolute ml-[0.7rem] mt-[-0.2rem] text-[1.3rem] font-semibold ">9028</h3>
                    <div class="mt-[0.5rem]">
                        <div class="text-[6rem] ">
                            <i class='text-black bx bx-bar-chart'></i>
                        </div>
                        <p class="bg-black text-white mx-[2.9rem] pb-[1px] rounded-[7px] text-[0.8rem] mt-[-2.2rem]">Jumlah Deposito</p>
                    </div>
                </div>
            </div>
            <div class="bg-gray-50 w-[14rem] h-[10rem] block justify-center rounded-[5px] box-border border-[1px] border-black shadow-lg">
                <div>
                    <div class="mt-[1.3rem]">
                        <div class="text-[5rem]">
                            <i class='text-black bx bx-briefcase-alt-2' ></i>
                        </div>
                        <p class="bg-black text-white mx-[4.8rem] pb-[1px] rounded-[7px] text-[0.8rem] mt-[-1.5rem]">Project</p>
                    </div>
                </div>
            </div>
            <div class="bg-gray-50 w-[14rem] h-[10rem] block justify-center rounded-[5px] box-border border-[1px] border-black shadow-lg">
                <div>
                    <div class="mt-[0.5rem]">
                        <div class="text-[6rem] ">
                            <i class='text-black bx bx-user'></i>
                        </div>
                        <p class="bg-black text-white mx-[3.8rem] pb-[1px] rounded-[7px] text-[0.8rem] mt-[-2.2rem]">Total Client</p>
                    </div>
                </div>
            </div>
            <div class="bg-gray-50 w-[14rem] h-[10rem] block justify-center rounded-[5px] box-border border-[1px] border-black shadow-lg">
                <div>
 
                    <div class="mt-[0.5rem]">
                        <div class="text-[6rem] ">
                            <i class='text-black bx bx-credit-card' ></i>
                        </div>
                        <p class="bg-black text-white mx-[2.9rem] pb-[1px] rounded-[7px] text-[0.8rem] mt-[-2.2rem]">Edit Banner</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="flex h-[53%] ml-[10rem] mt-[-1rem] gap-8">
            <div class="block  bg-gray-200 text-left overflow-auto h-[105%] mt-[0.5rem]">
                <a href="/Kredit">
                    <div class="w-[31rem] h-[4.4rem] bg-gray-100 rounded-[5px] my-[0.6rem] box-border border-[0.5px] border-black shadow-md">
                        <div class="flex">
                            <div class="text-[3.5rem] mt-[-0.1rem] mx-[1.5rem]">
                                <i class='text-black bx bx-credit-card' ></i>
                            </div>
                            <div class="block mt-[0.8rem]">
                                <h3 class="text-[1.1rem] font-bold">Kredit</h3>
                                <p class="mt-[-0.4rem]">opka oajdajdjoa doadoajd ad</p>
                            </div>
                        </div>
                    </div>
                </a>
                <a href="">
                    <div class="w-[31rem] h-[4.4rem] bg-gray-50 rounded-[5px] my-[0.6rem] box-border border-[0.5px] border-black shadow-md">
                        <div class="flex">
                            <div class="text-[3.5rem] mt-[-0.1rem] mx-[1.5rem]">
                                <i class='text-black bx bx-credit-card' ></i>
                            </div>
                            <div class="block mt-[0.8rem]">
                                <h3 class="text-[1.1rem] font-bold">Kredit</h3>
                                <p class="mt-[-0.4rem]">opka oajdajdjoa doadoajd ad</p>
                            </div>
                        </div>
                    </div>
                </a>
                <a href="">
                    <div class="w-[31rem] h-[4.4rem] bg-gray-50 rounded-[5px] my-[0.6rem] box-border border-[0.5px] border-black shadow-md">
                        <div class="flex">
                            <div class="text-[3.5rem] mt-[-0.1rem] mx-[1.5rem]">
                                <i class='text-black bx bx-credit-card' ></i>
                            </div>
                            <div class="block mt-[0.8rem]">
                                <h3 class="text-[1.1rem] font-bold">Kredit</h3>
                                <p class="mt-[-0.4rem]">opka oajdajdjoa doadoajd ad</p>
                            </div>
                        </div>
                    </div>
                </a>
                <a href="">
                    <div class="w-[31rem] h-[4.4rem] bg-gray-50 rounded-[5px] my-[0.6rem] box-border border-[0.5px] border-black shadow-md">
                        <div class="flex">
                            <div class="text-[3.5rem] mt-[-0.1rem] mx-[1.5rem]">
                                <i class='text-black bx bx-credit-card' ></i>
                            </div>
                            <div class="block mt-[0.8rem]">
                                <h3 class="text-[1.1rem] font-bold">Kredit</h3>
                                <p class="mt-[-0.4rem]">opka oajdajdjoa doadoajd ad</p>
                            </div>
                        </div>
                    </div>
                </a>
                <a href="">
                    <div class="w-[31rem] h-[4.4rem] bg-gray-50 rounded-[5px] my-[0.6rem] box-border border-[0.5px] border-black shadow-md">
                        <div class="flex">
                            <div class="text-[3.5rem] mt-[-0.1rem] mx-[1.5rem]">
                                <i class='text-black bx bx-credit-card' ></i>
                            </div>
                            <div class="block mt-[0.8rem]">
                                <h3 class="text-[1.1rem] font-bold">Kredit</h3>
                                <p class="mt-[-0.4rem]">opka oajdajdjoa doadoajd ad</p>
                            </div>
                        </div>
                    </div>
                </a>
                <a href="">
                    <div class="w-[31rem] h-[4.4rem] bg-gray-50 rounded-[5px] my-[0.6rem] box-border border-[0.5px] border-black shadow-md">
                        <div class="flex">
                            <div class="text-[3.5rem] mt-[-0.1rem] mx-[1.5rem]">
                                <i class='text-black bx bx-credit-card' ></i>
                            </div>
                            <div class="block mt-[0.8rem]">
                                <h3 class="text-[1.1rem] font-bold">Kredit</h3>
                                <p class="mt-[-0.4rem]">opka oajdajdjoa doadoajd ad</p>
                            </div>
                        </div>
                    </div>
                </a>
                <a href="">
                    <div class="w-[31rem] h-[4.4rem] bg-gray-50 rounded-[5px] my-[0.6rem] box-border border-[0.5px] border-black shadow-md">
                        <div class="flex">
                            <div class="text-[3.5rem] mt-[-0.1rem] mx-[1.5rem]">
                                <i class='text-black bx bx-credit-card' ></i>
                            </div>
                            <div class="block mt-[0.8rem]">
                                <h3 class="text-[1.1rem] font-bold">Kredit</h3>
                                <p class="mt-[-0.4rem]">opka oajdajdjoa doadoajd ad</p>
                            </div>
                        </div>
                    </div>
                </a>
                <a href="">
                    <div class="w-[31rem] h-[4.4rem] bg-gray-50 rounded-[5px] my-[0.6rem] box-border border-[0.5px] border-black shadow-md">
                        <div class="flex">
                            <div class="text-[3.5rem] mt-[-0.1rem] mx-[1.5rem]">
                                <i class='text-black bx bx-credit-card' ></i>
                            </div>
                            <div class="block mt-[0.8rem]">
                                <h3 class="text-[1.1rem] font-bold">Kredit</h3>
                                <p class="mt-[-0.4rem]">opka oajdajdjoa doadoajd ad</p>
                            </div>
                        </div>
                    </div>
                </a>
            </div>
            <div class="bg-gray-50 w-[26rem] my-[1rem] rounded-[5px] h-[100%]  box-border border-[0.5px] border-black shadow-lg overflow-auto">
                <div class="text-left text-[1.2rem] text-black pl-[2rem] pt-[1.2rem]">
                    <p>All Person Data</p>
                    <div class="pagination-links">
                        {{ $kredit->links() }}
                    </div>
                </div>
                <div class=" h-full mt-[1.5rem]" id="content">
                    @foreach ($kredit as $no => $data)
                        <a href="{{ route('kredit.show', $data->id ) }}">
                            <div class="border-b-[0.5px]  border-black border-dashed mx-[2rem] flex items-center cursor-pointer py-[0.1rem] my-[0.8rem]">
                                <p class="text-[1.3rem]">
                                    {{ ($kredit->currentPage() - 1) * $kredit->perPage() + $no + 1 }}
                                </p>
                                <div class="block px-[1rem] text-left">
                                    <h3 class="text-[0.8rem] font-medium">{{ $data->nama }}</h3>
                                    <div class="flex text-[0.7rem] mt-[-0.2rem] text-gray-400">
                                        <p>{{ Carbon::parse($data->created_at)->format('H:i') }}</p>
                                        <p class="px-[0.4rem]">|</p>
                                        <p>{{ Carbon::parse($data->created_at)->format('d F Y') }}</p>
                                    </div>
                                </div>
                                <p class="right-[2.2rem] py-[0.1rem] px-[1.3rem] bg-slate-200 text-[0.75rem] rounded-[10px]">
                                    {{ $data->jenis }}
                                </p>
                            </div>
                        </a>
                    @endforeach
                </div>
            </div>
        </div>
    </section>


    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script>
        let currentPage = 1;
        const pollingInterval = 3000;
    
        function fetchData(page = 1) {
            $.ajax({
                url: `/api/kredit?page=${page}`,
                method: 'GET',
                success: function(response) {
                    currentPage = response.pagination.current_page;
                    updateContent(response.data);
                    updatePagination(response.pagination);
                },
                error: function(xhr, status, error) {
                    console.error('Gagal mengambil data:', error);
                }
            });
        }
    
        function updateContent(data) {
            let content = '';
            data.forEach((item, index) => {
                const createdAt = new Date(item.created_at);
                const time = createdAt.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
                const date = createdAt.toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });
    
                content += `
                    <a href="/kredit/${item.id}">
                        <div class="border-b border-black border-dashed mx-8 flex items-center cursor-pointer py-2 my-2">
                            <p class="text-lg">${(currentPage - 1) * data.length + index + 1}</p>
                            <div class="px-4 text-left">
                                <h3 class="text-sm font-medium">${item.nama}</h3>
                                <div class="flex text-xs text-gray-400">
                                    <p>${time}</p>
                                    <p class="px-1">|</p>
                                    <p>${date}</p>
                                </div>
                            </div>
                            <p class="ml-auto py-1 px-3 bg-slate-200 text-xs rounded">${item.jenis}</p>
                        </div>
                    </a>
                `;
            });
            $('#content').html(content);
        }
    
        function updatePagination(pagination) {
            let paginationHtml = '';
    
            if (pagination.current_page > 1) {
                paginationHtml += `<a href="#" class="pagination-link" data-page="${pagination.current_page - 1} ">&laquo;</a>`;
            }
    
            for (let page = 1; page <= pagination.last_page; page++) {
                if (page === pagination.current_page) {
                    paginationHtml += `<span class="pagination-link current"></span>`;
                } else {
                    paginationHtml += `<a href="#" class="pagination-link" data-page="${page}"></a>`;
                }
            }
    
            if (pagination.current_page < pagination.last_page) {
                paginationHtml += `<a href="#" class="pagination-link" data-page="${pagination.current_page + 1}">&raquo;</a>`;
            }
    
            $('.pagination-links').html(paginationHtml);
        }
    
        $(document).on('click', '.pagination-link', function(e) {
            e.preventDefault();
            const page = $(this).data('page');
            if (page) {
                fetchData(page);
            }
        });
    
        fetchData(currentPage);
        setInterval(() => fetchData(currentPage), pollingInterval);
    </script>

@endsection